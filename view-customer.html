<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer Details</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin />
  <link rel="stylesheet" href="./styles/view-customer.css">
  <script src="./scripts/utils.js"></script>
  <script src="./scripts/view-customer.js"></script>
  <link rel="icon" type="image/x-icon" href="./assets/GEM-Group-2024.ico">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f8f9fb;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    @media (max-width: 576px) {
      .logo {
        height: 90px;
      }
    }

    h1 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 20px;
      color: #0b2a59;
    }



    @media (max-width: 768px) {
      .info-group {
        flex: 1 1 100%;
      }


    }

    .total-income-wrapper {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }

    .total-income-box {
      background-color: #f8f9fa;
      padding: 12px 16px;
      border-radius: 6px;
      font-size: 16px;
      color: #0b2a59;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .total-income-label {
      font-weight: 500;
      white-space: nowrap;
    }

    .total-income-value {
      background-color: #e9ecef;
      padding: 6px 12px;
      border-radius: 4px;
      font-weight: 600;
      line-height: 1;
      white-space: nowrap;
      font-feature-settings: "tnum";
      /* ensures tabular nums for equal spacing */
    }


    .total-income-label {
      color: var(--primary-color);
    }

    .customer-info-box {
      background-color: white;
      border: 1px solid var(--gray-300);
      border-radius: var(--border-radius-md);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
      box-shadow: var(--box-shadow-sm);
    }

    .info-row {
      display: flex;
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-md);
      flex-wrap: wrap;
    }

    .info-block {
      flex: 1;
      min-width: 250px;
    }

    .info-block label {
      display: block;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 4px;
    }

    .info-value {
      background-color: var(--gray-100);
      padding: var(--spacing-sm);
      border: 1px solid var(--gray-300);
      border-radius: var(--border-radius-sm);
    }

    .info-actions {
      margin-top: var(--spacing-md);
      text-align: right;
    }

    .address-section {
      margin-top: var(--spacing-lg);
    }

    .address-section h2 {
      font-size: var(--font-size-lg);
      color: var(--primary-color);
      margin-bottom: var(--spacing-sm);
    }

    #address-list {
      list-style: none;
      padding-left: 0;
      margin-bottom: var(--spacing-sm);
    }

    #address-list li {
      background-color: var(--gray-100);
      padding: var(--spacing-sm);
      margin-bottom: var(--spacing-xs);
      border: 1px solid var(--gray-300);
      border-radius: var(--border-radius-sm);
    }

    /* Dark Mode */
    body.dark-mode {
      background-color: #121212;
      color: #e0e0e0;
    }

    body.dark-mode h1 {
      color: #ffffff;
    }

    body.dark-mode h2 {
      color: #ffffff;
    }

    body.dark-mode label {
      color: #ffffff;
    }

    body.dark-mode .customer-info-box {
      background-color: #1e1e1e;
      border: 1px solid #333;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.6);
    }

    body.dark-mode .info-value {
      background-color: #2a2a2a;
      border: 1px solid #444;
      color: #f5f5f5;
    }

    body.dark-mode #address-list li {
      background-color: #2a2a2a;
      border: 1px solid #444;
      color: #fff;
    }

    body.dark-mode table {
      width: 100%;
      border-collapse: collapse;
      background-color: #1e1e1e;
      color: #f5f5f5;
    }

    body.dark-mode th {
      background-color: #2a2a2a;
      color: #ffffff;
      border: 1px solid #333;
    }

    body.dark-mode td {
      border: 1px solid #333;
    }

    body.dark-mode tr:nth-child(even) {
      background-color: #222;
    }

    body.dark-mode tr:hover {
      background-color: #2f2f2f;
    }

    body.dark-mode .total-income-box {
      background-color: #1e1e1e;
      color: #fff;
      border: 1px solid #333;
    }

    body.dark-mode .total-income-value {
      background-color: #2a2a2a;
      border: 1px solid #444;
      color: #fff;
    }

    body.dark-mode .modal-content {
      background-color: #1e1e1e;
      color: #fff;
      border: 1px solid #333;
    }

    body.dark-mode .total-income-label {
      color: #ffffff;
    }

    body.dark-mode .Delegate-management {
      background-color: #2a2a2a;
      border: 1px solid #444;
      padding: var(--spacing-lg);
      border-radius: var(--border-radius-md);
      color: #ffffff;
    }

    body.dark-mode .Delegate-management h2 {
      color: #ffffff;
    }

    body.dark-mode #Delegate-list li {
      background-color: #1e1e1e;
      border: 1px solid #333;
      color: #ffffff;
      padding: var(--spacing-sm);
      border-radius: var(--border-radius-sm);
    }

    /* Dark mode - Mobile card view */
    @media (max-width: 768px) {

      body.dark-mode .card-view .card,
      body.dark-mode #ordersCards>div {
        background-color: #2e2e2e !important;
        color: #fff !important;
        border: 1px solid #444 !important;
        border-radius: 10px;
        padding: 12px;
        margin-bottom: 12px;
      }

      body.dark-mode .card-view .card p,
      body.dark-mode #ordersCards>div p {
        color: #fff !important;
      }

      body.dark-mode .card-view .btn,
      body.dark-mode #ordersCards .btn {
        background-color: #28a745 !important;
        color: #fff !important;
      }

      #map {
        flex: 1;
        height: auto;
        min-height: 450px;
      }
    }

    #address-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    #address-modal .modal-content {
      width: 90%;
      max-width: 1000px;
      height: 75vh;
      display: flex;
      flex-direction: column;
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
    }

    .modal-content label {
      margin-bottom: 8px;
    }

    .modal-content button {
      margin: 6px;
    }

    #map {
      flex: 1;
      width: 100%;
      height: 100%;
      border-top: 1px solid #ddd;
      border-bottom: 1px solid #ddd;
    }


    body.dark-mode #map {
      border: 1px solid #444;
    }
  </style>
  <script>
    function applyTheme(mode) {
      if (mode === "dark") {
        document.body.classList.add("dark-mode");
      } else {
        document.body.classList.remove("dark-mode");
      }
    }

    window.addEventListener("message", (event) => {
      if (event.data.theme) {
        applyTheme(event.data.theme);
        localStorage.setItem("theme", event.data.theme);
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      const savedTheme = localStorage.getItem("theme") || "light";
      applyTheme(savedTheme);
    });
  </script>
</head>

<body>
  <h1>Customer Details</h1>

  <!-- Customer Info Section -->
  <div class="customer-info-box">
    <div class="info-row">
      <div class="info-block">
        <label>Customer Name:</label>
        <div class="info-value" id="customer-name"></div>
      </div>
      <div class="info-block">
        <label>Customer ID:</label>
        <div class="info-value" id="customer-id"></div>
      </div>
    </div>

    <div class="info-row">
      <div class="info-block">
        <label>Phone:</label>
        <div class="info-value" id="customer-phone"></div>
      </div>
      <div class="info-block">
        <label>Email:</label>
        <div class="info-value" id="customer-email"></div>
      </div>
    </div>

    <div class="info-actions">
      <button id="edit-customer-btn" class="btn edit-btn"> Edit Details</button>
    </div>

    <div class="address-section">
      <h2>Customer Addresses</h2>
      <ul id="address-list"></ul>
      <div class="info-actions">
        <button id="add-address-btn" class="btn edit-btn">Add Address</button>
      </div>
    </div>





    <!-- Info Boxes -->






    <!-- Delegate Management -->
    <div class="Delegate-management">
      <h2>Assigned Delegates</h2>
      <ul id="Delegate-list"></ul>
      <div class="info-actions">
        <button id="add-Delegate-btn" class="btn edit-btn"> Add Delegate</button>
      </div>
    </div>
    <!-- Order History -->
    <h2>Orders History</h2>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Order ID</th>
          <th>Date</th>
          <th>Delegate</th>
          <th>status</th>
          <th>Total Price</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="order-list">

      </tbody>
    </table>
    <!-- Card view (mobile) -->
    <div class="card-view" style="display: none;">
      <div id="ordersCards">
        <!-- Cards will be rendered here by JS -->
      </div>
    </div>

    <!-- Total Income -->



    <div class="total-income-wrapper">
      <div class="total-income-box">
        <span class="total-income-label">Orders total from Customer:</span>
        <span id="total-income-value" class="total-income-value">EGP 0.00</span>
      </div>
    </div>


  </div>

  <!-- Add Delegate Modal -->
  <div id="Delegate-modal" class="modal">
    <div class="modal-content">
      <span class="close-btn">&times;</span>
      <!-- <h2>Add Delegate</h2> -->
      <label>Select Delegate:</label>
      <select id="Delegate-dropdown">

      </select>
      <button id="save-Delegate-btn">Add</button>
    </div>
  </div>
  <!-- Address Modal -->
  <div id="address-modal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="address-close">&times;</span>
      <label for="address-input">Enter Address:</label>
      <input type="text" id="address-input" />
      <div id="map"></div>
      <button id="address-save-btn">Save</button>
    </div>

  </div>
  <!-- Edit Customer Modal -->
  <div id="edit-customer-modal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="edit-customer-close">&times;</span>
      <label for="edit-name">Full Name:</label>
      <input type="text" id="edit-name" />

      <label for="edit-phone">Phone:</label>
      <input type="text" id="edit-phone" />

      <label for="edit-email">Email:</label>
      <input type="email" id="edit-email" />

      <button id="save-customer-btn">Save Changes</button>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      document.getElementById("add-address-btn").addEventListener("click", () => {
        document.getElementById("address-modal").style.display = "flex";

        setTimeout(() => {
          map.invalidateSize();
        }, 200);
      });

      const map = L.map("map").setView([30.0444, 31.2357], 13);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "&copy; OpenStreetMap contributors",
      }).addTo(map);

      let marker;
      map.on("click", function (e) {
        console.log("Latitude: " + e.latlng.lat + ", Longitude: " + e.latlng.lng);
      });
      document.getElementById("checkInBtn").addEventListener("click", () => {
        if (!("geolocation" in navigator)) {
          alert("Geolocation not supported");
          return;
        }

        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const { latitude: lat, longitude: lon } = pos.coords;
            if (!marker) marker = L.marker([lat, lon]).addTo(map);
            marker.setLatLng([lat, lon]);
            map.setView([lat, lon], 17);
          },
          (err) => {
            alert("Error getting location: " + err.message);
          },
          { enableHighAccuracy: true }
        );
      });
    </script>
</body>

</html>